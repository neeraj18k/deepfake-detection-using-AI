<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DeepFake Detector — Predict</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    :root{
      --bg:#0f1724; /* dark navy */
      --card:#0b1220;
      --glass: rgba(255,255,255,0.04);
      --accent: #6ee7b7; /* soft mint */
    }
    html,body{height:100%;}
    body{
      background: radial-gradient(1200px 500px at 10% 10%, rgba(110,231,183,0.06), transparent),
                  linear-gradient(180deg, rgba(10,14,20,1) 0%, rgba(15,23,36,1) 100%);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #e6eef6;
      padding: 3rem 1rem;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .container-card{max-width:980px;margin:0 auto}
    .glass-card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.04);
      backdrop-filter: blur(8px) saturate(120%);
      border-radius: 16px;
      padding: 1.25rem;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
    }

    .app-header{display:flex;gap:1rem;align-items:center}
    .brand {display:flex;flex-direction:column}
    .brand h1{font-size:1.25rem;margin:0}
    .brand p{margin:0;font-size:0.85rem;color:rgba(230,238,246,0.7)}

    .uploader{border:1px dashed rgba(255,255,255,0.05);border-radius:12px;padding:1rem;cursor:pointer}
    .uploader.drag{background:rgba(110,231,183,0.02);border-color:rgba(110,231,183,0.14)}

    img.preview{max-width:100%;max-height:360px;border-radius:10px;object-fit:contain}

    .result-value{font-size:2.25rem;font-weight:700}
    .subtle{color:rgba(230,238,246,0.7)}

    .muted{color:rgba(230,238,246,0.55);font-size:0.92rem}

    @media (max-width:768px){
      body{padding:1.25rem}
      .result-value{font-size:1.6rem}
    }

    /* little animated pulse for model badge */
    .model-badge{display:inline-flex;align-items:center;gap:.5rem;padding:.25rem .6rem;border-radius:999px;background:linear-gradient(90deg, rgba(110,231,183,0.07), rgba(110,231,183,0.03));border:1px solid rgba(110,231,183,0.06)}
    .dot{width:9px;height:9px;border-radius:50%;background:var(--accent);box-shadow:0 0 10px rgba(110,231,183,0.16)}
  </style>
</head>
<body>
  <div class="container container-card">
    <div class="glass-card">
      <div class="d-flex justify-content-between align-items-start mb-3 app-header">
        <div class="brand">
          <h1 class="mb-0">DeepFake Detector</h1>
          <p class="muted">Upload an image and the model returns the probability it is a deepfake (0–100%).</p>
        </div>

        <div class="text-end">
          <div class="model-badge">
            <div class="dot" aria-hidden="true"></div>
            <div class="muted">EfficientNet‑B0 • 128px • Calibrated</div>
          </div>
        </div>
      </div>

      <!-- Form (Flask/Jinja compatible) -->
      <form method="post" action="{{ url_for('predict') }}" enctype="multipart/form-data" id="predictForm">
        <div class="row gx-3 align-items-center">
          <div class="col-lg-6">
            <label for="fileInput" class="form-label mb-2 subtle">Choose image</label>

            <div id="dropZone" class="uploader" tabindex="0">
              <div class="d-flex align-items-center gap-3">
                <div class="fs-2 text-muted"><i class="bi bi-image"></i></div>
                <div>
                  <div class="fw-semibold">Drag & drop an image, or</div>
                  <div class="muted">PNG, JPG, JPEG — recommended up to 1024×1024</div>
                </div>
              </div>

              <input class="form-control mt-3" type="file" id="fileInput" name="image" accept="image/*" required style="opacity:0;position:absolute;left:-9999px;" />
              <div class="mt-3">
                <button type="button" class="btn btn-outline-light btn-sm" id="chooseBtn"><i class="bi bi-upload me-1"></i>Select file</button>
                <button type="submit" class="btn btn-primary btn-sm ms-2" id="predictBtn"><i class="bi bi-robot me-1"></i> Predict</button>
                <a href="{{ url_for('home') }}" class="btn btn-link btn-sm text-decoration-none ms-2">Reset</a>
              </div>
            </div>

            <div class="mt-3">
              {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                  {% for category, msg in messages %}
                    <div class="alert alert-{{ category }} small mb-2">{{ msg }}</div>
                  {% endfor %}
                {% endif %}
              {% endwith %}
            </div>

            <div class="mt-2 muted small">Tip: clear backgrounds and faces that are well-lit perform better.</div>
          </div>

          <div class="col-lg-6">
            <!-- Preview / Result Card -->
            <div class="p-3 rounded-3" style="background:var(--glass);">
              {% if result %}
                <div class="d-flex gap-3 align-items-start">
                  <div style="width:42%;">
                    <p class="muted mb-1">Uploaded</p>
                    <img src="{{ url_for('uploaded_file', filename=result.filename) }}" class="preview" alt="uploaded image" />
                  </div>
                  <div style="flex:1;">
                    <p class="muted mb-1">Model output</p>
                    <div class="result-value">{{ "%.2f"|format(result.percent) }}%</div>
                    <div class="muted mb-3">(calibrated probability — higher means more likely <strong>fake</strong>)</div>

                    <div class="mb-2">
                      <span class="muted">Raw model probability:</span>
                      <div class="fw-semibold">{{ "%.4f"|format(result.raw_prob) }}</div>
                    </div>

                    <div class="mt-3">
                      {% if result.percent >= 50 %}
                        <div class="alert alert-danger py-2"><i class="bi bi-exclamation-triangle-fill me-2"></i><strong>Prediction:</strong> Likely <em>FAKE</em></div>
                      {% else %}
                        <div class="alert alert-success py-2"><i class="bi bi-check-circle-fill me-2"></i><strong>Prediction:</strong> Likely <em>REAL</em></div>
                      {% endif %}
                    </div>

                    <div class="mt-2 muted small">Confidence calibration applied (Platt scaling / isotonic). Use thresholds conservatively.</div>
                  </div>
                </div>
              {% else %}
                <div class="text-center py-5">
                  <i class="bi bi-image fs-1 text-muted"></i>
                  <p class="muted mt-2">No image selected yet — preview will appear here.</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </form>

      <hr class="mt-4" />
      <div class="d-flex justify-content-between align-items-center muted small">
        <div>Model: <strong>EfficientNet-B0</strong> · Image size: <strong>128</strong></div>
        <div>Built with care • <span class="text-nowrap">Calibration applied</span></div>
      </div>
    </div>

    <div class="text-center mt-3 muted small">© {{ current_year or "2025" }} — Use responsibly. This tool provides probabilistic outputs and may be incorrect.</div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Small UX: clicking the visible button opens hidden input
    const fileInput = document.getElementById('fileInput');
    const chooseBtn = document.getElementById('chooseBtn');
    const dropZone = document.getElementById('dropZone');
    const predictForm = document.getElementById('predictForm');

    chooseBtn.addEventListener('click', () => fileInput.click());

    // Drag & drop interaction
    ['dragenter','dragover'].forEach(ev => {
      dropZone.addEventListener(ev, (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.add('drag'); });
    });
    ['dragleave','drop'].forEach(ev => {
      dropZone.addEventListener(ev, (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag'); });
    });

    dropZone.addEventListener('drop', (e)=>{
      const dt = e.dataTransfer;
      if(!dt || !dt.files || dt.files.length===0) return;
      fileInput.files = dt.files; // set files for form submit
      showPreview(dt.files[0]);
    });

    fileInput.addEventListener('change', (e)=>{
      if(e.target.files && e.target.files[0]) showPreview(e.target.files[0]);
    });

    function showPreview(file){
      // create preview image element if not present
      const existing = document.querySelector('.preview');
      const reader = new FileReader();
      reader.onload = function(ev){
        if(existing){ existing.src = ev.target.result; }
        else{
          // create a quick preview area in the left column (mobile-friendly fallback)
          const img = document.createElement('img');
          img.className = 'preview';
          img.src = ev.target.result;
          const container = document.querySelector('#dropZone');
          container.parentNode.querySelector('.muted');
          container.appendChild(img);
        }
      };
      reader.readAsDataURL(file);
    }

    // Accessibility: allow Enter/Space to open file picker on dropZone
    dropZone.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });

    // Optional: prevent multiple submits while waiting for server
    predictForm.addEventListener('submit', (e)=>{
      const btn = document.getElementById('predictBtn');
      btn.disabled = true; btn.innerHTML = '<i class="bi bi-hourglass-split me-1"></i> Predicting...';
    });
  </script>
</body>
</html>